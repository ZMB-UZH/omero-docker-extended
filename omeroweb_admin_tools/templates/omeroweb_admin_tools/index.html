{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin tools</title>
    <link rel="stylesheet" href="{% static 'omeroweb_admin_tools/styles.css' %}">
</head>
<body>
    <div class="root-user-overlay" aria-hidden="true"></div>
    <div id="root-user-warning" class="root-user-warning" role="alert"></div>
    <div class="admin-tools-page">
        <div class="admin-tools-header">
            <h1 class="admin-tools-title">Admin tools</h1>
            <div class="admin-tools-header-actions">
                <div style="position:relative;">
                    <button type="button"
                            id="settings_menu_btn"
                            class="icon-btn"
                            title="Settings"
                            aria-label="Settings">
                        âš™
                    </button>
                    <div id="settings_menu"
                         class="settings-menu"
                         style="display:none;">
                        <button type="button"
                                id="admin_settings_btn"
                                class="settings-menu-item">
                            Admin settings
                        </button>
                    </div>
                </div>
                <a href="{% url 'omeroweb_admin_tools_help' %}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="help-btn"
                   title="Help"
                   aria-label="Help">
                    ?
                </a>
            </div>
        </div>
        <div class="admin-tools-card">
            <div class="admin-tools-actions">
                <a class="admin-tools-button admin-tools-button-link"
                   href="{% url 'omeroweb_admin_tools_logs' %}">
                    Logs
                </a>
                <a class="admin-tools-button admin-tools-button-link" href="{% url 'omeroweb_admin_tools_storage' %}">Storage viewer &amp; Quotas</a>
                <a class="admin-tools-button admin-tools-button-link" href="{% url 'omeroweb_admin_tools_resource_monitoring' %}">Resource monitoring</a>
                <a class="admin-tools-button admin-tools-button-link" href="{% url 'omeroweb_admin_tools_server_database_testing' %}">OMERO.server and database testing</a>
            </div>
        </div>
    </div>
    <script defer>
const rootStatusUrl = new URL('{% url "omeroweb_admin_tools_root_status" %}', window.location.href);
        const setWarningMessage = (lineACodes, lineBCodes) => {
            const warningEl = document.getElementById('root-user-warning');
            if (!warningEl) {
                return;
            }
            const decode = (codes) => String.fromCharCode(...codes);
            warningEl.replaceChildren();
            warningEl.appendChild(document.createTextNode(decode(lineACodes)));
            warningEl.appendChild(document.createElement('br'));
            warningEl.appendChild(document.createTextNode(decode(lineBCodes)));
        };
        const applyRootUserState = (isRootUser) => {
            if (isRootUser) {
                return;
            }
            setWarningMessage(
                [80, 76, 69, 65, 83, 69, 32, 76, 79, 71, 73, 78, 32, 65, 83, 32, 82, 79, 79, 84, 32, 85, 83, 69, 82],
                [84, 79, 32, 85, 83, 69, 32, 84, 72, 73, 83, 32, 80, 76, 85, 71, 73, 78]
            );
            document.documentElement.classList.add('root-user-blocked');
            if (document.body) {
                document.body.classList.add('root-user-blocked');
            }
        };
        fetch(rootStatusUrl, { credentials: 'same-origin' })
            .then((resp) => (resp.ok ? resp.json() : null))
            .then((data) => {
                if (data && data.is_root_user === false) {
                    applyRootUserState(false);
                }
            })
            .catch(() => {
                // Ignore root user lookup failures.
            });
        const settingsMenuBtn = document.getElementById('settings_menu_btn');
        const settingsMenu = document.getElementById('settings_menu');

        function showSettingsMenu(show) {
            if (!settingsMenu) {
                return;
            }
            settingsMenu.style.display = show ? 'block' : 'none';
        }

        if (settingsMenuBtn) {
            settingsMenuBtn.addEventListener('click', (event) => {
                event.stopPropagation();
                const shouldShow = settingsMenu?.style.display !== 'block';
                showSettingsMenu(shouldShow);
            });
        }

        document.addEventListener('click', (event) => {
            if (!settingsMenu) {
                return;
            }
            if (settingsMenu.contains(event.target) || settingsMenuBtn?.contains(event.target)) {
                return;
            }
            showSettingsMenu(false);
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                showSettingsMenu(false);
            }
        });
    </script>
</body>
</html>
